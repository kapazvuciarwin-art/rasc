# Telegram 通知設定說明

## 功能說明

當感測器數值超過設定的閾值時，系統會自動發送 Telegram 通知。

## 設定步驟

### 1. 創建 Telegram Bot

1. 在 Telegram 中搜尋 `@BotFather`
2. 發送 `/newbot` 指令
3. 按照提示設定 Bot 名稱和用戶名
4. BotFather 會回傳 Bot Token（格式類似：`123456789:ABCdefGHIjklMNOpqrsTUVwxyz`）
5. **保存這個 Token**，稍後需要用到

### 2. 獲取 Chat ID

有兩種方式獲取您的 Chat ID：

#### 方式一：使用 @userinfobot
1. 在 Telegram 中搜尋 `@userinfobot`
2. 發送任意消息給它
3. Bot 會回傳您的 Chat ID（一串數字，例如：`123456789`）

#### 方式二：使用 @getidsbot
1. 在 Telegram 中搜尋 `@getidsbot`
2. 發送 `/start` 指令
3. Bot 會回傳您的 Chat ID

### 3. 在網站中設定

1. 打開監控網站：`http://<樹莓派IP>:5005`
2. 點擊右上角的「⚙️ 通知設定」按鈕
3. 勾選「啟用 Telegram 通知」
4. 填入：
   - **Bot Token**：從 BotFather 獲得的 Token
   - **Chat ID**：您的 Telegram Chat ID
5. 設定各感測器的閾值：
   - **CO₂ 濃度**：設定最大值（例如：1000 ppm）
   - **溫度**：設定最小值和最大值（例如：10-30°C）
   - **濕度**：設定最小值和最大值（例如：30-70%）
6. 設定冷卻時間（分鐘）：避免重複通知的間隔時間
7. 點擊「測試通知」確認設定正確
8. 點擊「儲存設定」

## 設定說明

### 閾值設定

- **最小值**：當數值低於此值時發送通知（可留空表示不限制）
- **最大值**：當數值超過此值時發送通知（可留空表示不限制）
- **冷卻時間**：兩次通知之間的最小間隔時間（分鐘），避免重複通知

### 範例設定

**CO₂ 濃度**：
- 啟用：✓
- 最大值：1000 ppm
- 冷卻時間：30 分鐘
- 說明：當 CO₂ 超過 1000 ppm 時發送通知，30 分鐘內不會重複通知

**溫度**：
- 啟用：✓
- 最小值：10°C
- 最大值：30°C
- 冷卻時間：30 分鐘
- 說明：當溫度低於 10°C 或超過 30°C 時發送通知

**濕度**：
- 啟用：✓
- 最小值：30%
- 最大值：70%
- 冷卻時間：30 分鐘
- 說明：當濕度低於 30% 或超過 70% 時發送通知

## 通知格式

當觸發通知時，您會收到類似以下格式的消息：

```
⚠️ MyCO2 感測器警報

• co2_ppm 超過最大值 1000（當前值: 1234.00）
• temperature_c 超過最大值 30（當前值: 32.50）

時間: 2026-02-15 08:30:45
```

## 故障排除

### 無法收到通知

1. 確認 Bot Token 和 Chat ID 正確
2. 使用「測試通知」功能檢查設定
3. 檢查感測器數值是否真的超過閾值
4. 確認冷卻時間是否已過（不會立即重複通知）
5. 查看服務日誌：`journalctl --user -u rasc.service -f`

### 配置文件位置

配置文件保存在：`/home/kapraspi/rasc/telegram_config.json`

如果需要手動編輯，可以：
```bash
cd /home/kapraspi/rasc
nano telegram_config.json
```

然後重啟服務：
```bash
systemctl --user restart rasc.service
```

## 安全注意事項

- Bot Token 是敏感信息，請勿分享給他人
- 配置文件包含敏感信息，請確保文件權限正確
- 建議定期檢查 Bot 的活動狀態
