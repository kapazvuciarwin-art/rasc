<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyCO2 ç›£æ§å„€è¡¨æ¿</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: "Segoe UI", "Noto Sans TC", sans-serif;
            background: linear-gradient(145deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e8e8e8;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .status-bar {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .status-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            min-width: 200px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .status-card h3 {
            font-size: 0.9em;
            color: #a1a1aa;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .status-card .value {
            font-size: 2.5em;
            font-weight: bold;
            color: #fff;
            margin-bottom: 5px;
        }
        
        .status-card .unit {
            font-size: 1em;
            color: #a1a1aa;
        }
        
        .status-card.co2 .value { color: #60a5fa; }
        .status-card.temp .value { color: #f87171; }
        .status-card.humidity .value { color: #34d399; }
        .status-card.rssi .value { color: #a78bfa; }
        
        .status-card .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 10px;
            background: #ef4444;
            animation: pulse 2s infinite;
        }
        
        .status-card .status-indicator.active {
            background: #10b981;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .chart-container h2 {
            margin-bottom: 20px;
            color: #fff;
            font-size: 1.5em;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .btn.active {
            background: #3b82f6;
        }
        
        .timestamp {
            text-align: center;
            color: #a1a1aa;
            margin-top: 20px;
            font-size: 0.9em;
        }
        
        .no-data {
            text-align: center;
            color: #a1a1aa;
            padding: 40px;
            font-size: 1.2em;
        }
        
        /* è¨­å®šæ¨¡æ…‹æ¡† */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: linear-gradient(145deg, #1a1a2e 0%, #16213e 100%);
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .modal-header h2 {
            color: #fff;
            margin: 0;
        }
        
        .close {
            color: #a1a1aa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
        }
        
        .close:hover {
            color: #fff;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #e8e8e8;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 1em;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        .form-group input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .threshold-section {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .threshold-section h3 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: #fff;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .alert {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .alert-success {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .alert-error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h1 style="margin: 0;">ğŸŒ¡ï¸ MyCO2 ç’°å¢ƒç›£æ§å„€è¡¨æ¿</h1>
            <button class="btn" onclick="openSettings()" style="padding: 12px 24px; font-size: 1em;">âš™ï¸ é€šçŸ¥è¨­å®š</button>
        </div>
        
        <div class="status-bar">
            <div class="status-card co2">
                <h3>COâ‚‚ æ¿ƒåº¦</h3>
                <div class="value" id="co2-value">--</div>
                <div class="unit">ppm</div>
                <span class="status-indicator" id="co2-indicator"></span>
            </div>
            
            <div class="status-card temp">
                <h3>æº«åº¦</h3>
                <div class="value" id="temp-value">--</div>
                <div class="unit">Â°C</div>
                <span class="status-indicator" id="temp-indicator"></span>
            </div>
            
            <div class="status-card humidity">
                <h3>æ¿•åº¦</h3>
                <div class="value" id="humidity-value">--</div>
                <div class="unit">%</div>
                <span class="status-indicator" id="humidity-indicator"></span>
            </div>
            
            <div class="status-card rssi">
                <h3>è¨Šè™Ÿå¼·åº¦</h3>
                <div class="value" id="rssi-value">--</div>
                <div class="unit">dBm</div>
                <span class="status-indicator" id="rssi-indicator"></span>
            </div>
        </div>
        
        <div class="chart-container">
            <h2>æ­·å²æ•¸æ“š</h2>
            <div class="controls">
                <button class="btn active" onclick="loadHistory(1)">1å°æ™‚</button>
                <button class="btn" onclick="loadHistory(6)">6å°æ™‚</button>
                <button class="btn" onclick="loadHistory(24)">24å°æ™‚</button>
                <button class="btn" onclick="loadHistory(48)">48å°æ™‚</button>
            </div>
            <canvas id="historyChart"></canvas>
        </div>
        
        <div class="timestamp" id="last-update">
            æœ€å¾Œæ›´æ–°: --
        </div>
    </div>
    
    <!-- è¨­å®šæ¨¡æ…‹æ¡† -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“± Telegram é€šçŸ¥è¨­å®š</h2>
                <button class="close" onclick="closeSettings()">&times;</button>
            </div>
            <div id="settingsAlert"></div>
            <form id="settingsForm">
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="enabled" onchange="toggleSettings()">
                        å•Ÿç”¨ Telegram é€šçŸ¥
                    </label>
                </div>
                
                <div id="settingsFields" style="display: none;">
                    <div class="form-group">
                        <label>Bot Token</label>
                        <input type="text" id="bot_token" placeholder="ä¾‹å¦‚: 123456789:ABCdefGHIjklMNOpqrsTUVwxyz">
                    </div>
                    
                    <div class="form-group">
                        <label>Chat ID</label>
                        <input type="text" id="chat_id" placeholder="ä¾‹å¦‚: 123456789">
                    </div>
                    
                    <div class="threshold-section">
                        <h3>COâ‚‚ æ¿ƒåº¦ (ppm)</h3>
                        <label>
                            <input type="checkbox" id="co2_enabled">
                            å•Ÿç”¨ COâ‚‚ é€šçŸ¥
                        </label>
                        <div class="form-row" style="margin-top: 15px;">
                            <div class="form-group">
                                <label>æœ€å°å€¼</label>
                                <input type="number" id="co2_min" placeholder="ç•™ç©ºè¡¨ç¤ºä¸é™åˆ¶">
                            </div>
                            <div class="form-group">
                                <label>æœ€å¤§å€¼</label>
                                <input type="number" id="co2_max" placeholder="ä¾‹å¦‚: 1000">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>å†·å»æ™‚é–“ï¼ˆåˆ†é˜ï¼‰</label>
                            <input type="number" id="co2_cooldown" value="30" min="1">
                        </div>
                    </div>
                    
                    <div class="threshold-section">
                        <h3>æº«åº¦ (Â°C)</h3>
                        <label>
                            <input type="checkbox" id="temp_enabled">
                            å•Ÿç”¨æº«åº¦é€šçŸ¥
                        </label>
                        <div class="form-row" style="margin-top: 15px;">
                            <div class="form-group">
                                <label>æœ€å°å€¼</label>
                                <input type="number" id="temp_min" placeholder="ä¾‹å¦‚: 10">
                            </div>
                            <div class="form-group">
                                <label>æœ€å¤§å€¼</label>
                                <input type="number" id="temp_max" placeholder="ä¾‹å¦‚: 30">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>å†·å»æ™‚é–“ï¼ˆåˆ†é˜ï¼‰</label>
                            <input type="number" id="temp_cooldown" value="30" min="1">
                        </div>
                    </div>
                    
                    <div class="threshold-section">
                        <h3>æ¿•åº¦ (%)</h3>
                        <label>
                            <input type="checkbox" id="humidity_enabled">
                            å•Ÿç”¨æ¿•åº¦é€šçŸ¥
                        </label>
                        <div class="form-row" style="margin-top: 15px;">
                            <div class="form-group">
                                <label>æœ€å°å€¼</label>
                                <input type="number" id="humidity_min" placeholder="ä¾‹å¦‚: 30">
                            </div>
                            <div class="form-group">
                                <label>æœ€å¤§å€¼</label>
                                <input type="number" id="humidity_max" placeholder="ä¾‹å¦‚: 70">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>å†·å»æ™‚é–“ï¼ˆåˆ†é˜ï¼‰</label>
                            <input type="number" id="humidity_cooldown" value="30" min="1">
                        </div>
                    </div>
                    
                    <button type="button" class="btn-secondary" onclick="testTelegram()">æ¸¬è©¦é€šçŸ¥</button>
                    <button type="submit" class="btn-primary">å„²å­˜è¨­å®š</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // WebSocket é€£æ¥
        const socket = io();
        
        // åœ–è¡¨
        let historyChart = null;
        let currentHours = 24;
        
        // åˆå§‹åŒ–åœ–è¡¨
        function initChart() {
            const ctx = document.getElementById('historyChart').getContext('2d');
            historyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'COâ‚‚ (ppm)',
                            data: [],
                            borderColor: '#60a5fa',
                            backgroundColor: 'rgba(96, 165, 250, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'æº«åº¦ (Â°C)',
                            data: [],
                            borderColor: '#f87171',
                            backgroundColor: 'rgba(248, 113, 113, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'æ¿•åº¦ (%)',
                            data: [],
                            borderColor: '#34d399',
                            backgroundColor: 'rgba(52, 211, 153, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y2'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e8e8e8'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: 'rgba(255, 255, 255, 0.1)',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#a1a1aa' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            ticks: { color: '#60a5fa' },
                            grid: { color: 'rgba(96, 165, 250, 0.1)' },
                            title: {
                                display: true,
                                text: 'COâ‚‚ (ppm)',
                                color: '#60a5fa'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            ticks: { color: '#f87171' },
                            grid: { drawOnChartArea: false },
                            title: {
                                display: true,
                                text: 'æº«åº¦ (Â°C)',
                                color: '#f87171'
                            }
                        },
                        y2: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            ticks: { color: '#34d399' },
                            grid: { drawOnChartArea: false },
                            title: {
                                display: true,
                                text: 'æ¿•åº¦ (%)',
                                color: '#34d399'
                            }
                        }
                    }
                }
            });
        }
        
        // æ›´æ–°é¡¯ç¤ºå€¼
        function updateDisplay(data) {
            if (data.co2_ppm !== null && data.co2_ppm !== undefined) {
                document.getElementById('co2-value').textContent = data.co2_ppm;
                document.getElementById('co2-indicator').classList.add('active');
            }
            
            if (data.temperature_c !== null && data.temperature_c !== undefined) {
                document.getElementById('temp-value').textContent = data.temperature_c.toFixed(1);
                document.getElementById('temp-indicator').classList.add('active');
            }
            
            if (data.humidity !== null && data.humidity !== undefined) {
                document.getElementById('humidity-value').textContent = data.humidity.toFixed(1);
                document.getElementById('humidity-indicator').classList.add('active');
            }
            
            if (data.rssi !== null && data.rssi !== undefined) {
                document.getElementById('rssi-value').textContent = data.rssi;
                document.getElementById('rssi-indicator').classList.add('active');
            }
            
            if (data.timestamp) {
                const date = new Date(data.timestamp);
                document.getElementById('last-update').textContent = 
                    `æœ€å¾Œæ›´æ–°: ${date.toLocaleString('zh-TW')}`;
            }
        }
        
        // è¼‰å…¥æ­·å²æ•¸æ“š
        async function loadHistory(hours) {
            currentHours = hours;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            try {
                const response = await fetch(`/api/history?hours=${hours}`);
                const data = await response.json();
                
                if (data.length === 0) {
                    historyChart.data.labels = [];
                    historyChart.data.datasets[0].data = [];
                    historyChart.data.datasets[1].data = [];
                    historyChart.data.datasets[2].data = [];
                    historyChart.update();
                    return;
                }
                
                // è™•ç†æ•¸æ“š
                const labels = data.map(d => {
                    const date = new Date(d.timestamp);
                    return date.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });
                });
                
                const co2Data = data.map(d => d.co2_ppm).filter(v => v !== null);
                const tempData = data.map(d => d.temperature_c).filter(v => v !== null);
                const humidityData = data.map(d => d.humidity).filter(v => v !== null);
                
                // æ›´æ–°åœ–è¡¨
                historyChart.data.labels = labels;
                historyChart.data.datasets[0].data = data.map(d => d.co2_ppm);
                historyChart.data.datasets[1].data = data.map(d => d.temperature_c);
                historyChart.data.datasets[2].data = data.map(d => d.humidity);
                historyChart.update();
                
            } catch (error) {
                console.error('è¼‰å…¥æ­·å²æ•¸æ“šå¤±æ•—:', error);
            }
        }
        
        // WebSocket äº‹ä»¶è™•ç†
        socket.on('connect', () => {
            console.log('å·²é€£æ¥åˆ°ä¼ºæœå™¨');
            // è¼‰å…¥åˆå§‹æ•¸æ“š
            fetch('/api/latest')
                .then(r => r.json())
                .then(data => updateDisplay(data));
            loadHistory(24);
        });
        
        socket.on('sensor_update', (data) => {
            updateDisplay(data);
        });
        
        // åˆå§‹åŒ–
        initChart();
        loadHistory(24);
        
        // å®šæœŸåˆ·æ–°æ­·å²æ•¸æ“š
        setInterval(() => {
            loadHistory(currentHours);
        }, 60000); // æ¯åˆ†é˜æ›´æ–°ä¸€æ¬¡
        
        // è¨­å®šç›¸é—œå‡½æ•¸
        function openSettings() {
            document.getElementById('settingsModal').style.display = 'block';
            loadSettings();
        }
        
        function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
            document.getElementById('settingsAlert').innerHTML = '';
        }
        
        function toggleSettings() {
            const enabled = document.getElementById('enabled').checked;
            document.getElementById('settingsFields').style.display = enabled ? 'block' : 'none';
        }
        
        async function loadSettings() {
            try {
                const response = await fetch('/api/telegram/config');
                const config = await response.json();
                
                document.getElementById('enabled').checked = config.enabled || false;
                toggleSettings();
                
                if (config.bot_token && config.bot_token !== '***') {
                    document.getElementById('bot_token').value = config.bot_token;
                }
                document.getElementById('chat_id').value = config.chat_id || '';
                
                // CO2 è¨­å®š
                const co2 = config.thresholds.co2_ppm || {};
                document.getElementById('co2_enabled').checked = co2.enabled || false;
                document.getElementById('co2_min').value = co2.min || '';
                document.getElementById('co2_max').value = co2.max || '';
                document.getElementById('co2_cooldown').value = co2.cooldown_minutes || 30;
                
                // æº«åº¦è¨­å®š
                const temp = config.thresholds.temperature_c || {};
                document.getElementById('temp_enabled').checked = temp.enabled || false;
                document.getElementById('temp_min').value = temp.min || '';
                document.getElementById('temp_max').value = temp.max || '';
                document.getElementById('temp_cooldown').value = temp.cooldown_minutes || 30;
                
                // æ¿•åº¦è¨­å®š
                const humidity = config.thresholds.humidity || {};
                document.getElementById('humidity_enabled').checked = humidity.enabled || false;
                document.getElementById('humidity_min').value = humidity.min || '';
                document.getElementById('humidity_max').value = humidity.max || '';
                document.getElementById('humidity_cooldown').value = humidity.cooldown_minutes || 30;
            } catch (error) {
                showAlert('è¼‰å…¥è¨­å®šå¤±æ•—: ' + error.message, 'error');
            }
        }
        
        async function saveSettings(event) {
            event.preventDefault();
            
            const config = {
                enabled: document.getElementById('enabled').checked,
                bot_token: document.getElementById('bot_token').value,
                chat_id: document.getElementById('chat_id').value,
                thresholds: {
                    co2_ppm: {
                        enabled: document.getElementById('co2_enabled').checked,
                        min: document.getElementById('co2_min').value ? parseFloat(document.getElementById('co2_min').value) : null,
                        max: document.getElementById('co2_max').value ? parseFloat(document.getElementById('co2_max').value) : null,
                        cooldown_minutes: parseInt(document.getElementById('co2_cooldown').value) || 30
                    },
                    temperature_c: {
                        enabled: document.getElementById('temp_enabled').checked,
                        min: document.getElementById('temp_min').value ? parseFloat(document.getElementById('temp_min').value) : null,
                        max: document.getElementById('temp_max').value ? parseFloat(document.getElementById('temp_max').value) : null,
                        cooldown_minutes: parseInt(document.getElementById('temp_cooldown').value) || 30
                    },
                    humidity: {
                        enabled: document.getElementById('humidity_enabled').checked,
                        min: document.getElementById('humidity_min').value ? parseFloat(document.getElementById('humidity_min').value) : null,
                        max: document.getElementById('humidity_max').value ? parseFloat(document.getElementById('humidity_max').value) : null,
                        cooldown_minutes: parseInt(document.getElementById('humidity_cooldown').value) || 30
                    }
                }
            };
            
            try {
                const response = await fetch('/api/telegram/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(config)
                });
                
                const result = await response.json();
                if (result.success) {
                    showAlert('è¨­å®šå·²å„²å­˜ï¼', 'success');
                } else {
                    showAlert('å„²å­˜å¤±æ•—: ' + (result.error || 'æœªçŸ¥éŒ¯èª¤'), 'error');
                }
            } catch (error) {
                showAlert('å„²å­˜å¤±æ•—: ' + error.message, 'error');
            }
        }
        
        async function testTelegram() {
            try {
                const response = await fetch('/api/telegram/test', {
                    method: 'POST'
                });
                
                const result = await response.json();
                if (result.success) {
                    showAlert('æ¸¬è©¦é€šçŸ¥å·²ç™¼é€ï¼è«‹æª¢æŸ¥æ‚¨çš„ Telegramã€‚', 'success');
                } else {
                    showAlert('æ¸¬è©¦å¤±æ•—: ' + (result.error || 'æœªçŸ¥éŒ¯èª¤'), 'error');
                }
            } catch (error) {
                showAlert('æ¸¬è©¦å¤±æ•—: ' + error.message, 'error');
            }
        }
        
        function showAlert(message, type) {
            const alertDiv = document.getElementById('settingsAlert');
            alertDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                alertDiv.innerHTML = '';
            }, 5000);
        }
        
        // ç¶å®šè¡¨å–®æäº¤äº‹ä»¶
        document.getElementById('settingsForm').addEventListener('submit', saveSettings);
        
        // é»æ“Šæ¨¡æ…‹æ¡†å¤–éƒ¨é—œé–‰
        window.onclick = function(event) {
            const modal = document.getElementById('settingsModal');
            if (event.target == modal) {
                closeSettings();
            }
        }
    </script>
</body>
</html>
